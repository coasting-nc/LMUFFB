You will have to work on the files downloaded from this repo https://github.com/coasting-nc/LMUFFB and start working on the tasks described below. Therefore, if you haven't done it already, clone this repo https://github.com/coasting-nc/LMUFFB and start working on the tasks described below.

Please initialize this session by following the **Standard Task Workflow** defined in `AGENTS.md`.

1.  **Sync**: Run `git fetch && git reset --hard origin/main` for the LMUFFB repository to ensure you see the latest files.
1.  **Load Memory**: Read `AGENTS_MEMORY.md` from the root dir of the LMUFFB repository to review build workarounds and architectural insights. 
2.  **Load Rules**: Read `AGENTS.md` from the root dir of the LMUFFB repository to confirm instructions. 

Once you have reviewed these documents, please proceed with the following task:

**Task: Implement Synthetic Gyroscopic Damping**

**Reference Documents:**
*   `docs/dev_docs/Yaw, Gyroscopic Damping , Dynamic Weight, Per-Wheel Hydro-Grain, and Adaptive Optimal Slip Angle implementation.md` (Section 4.2 and 8.4).
*   `src/lmu_sm_interface/InternalsPlugin.hpp` (For steering inputs).

**Context:**
We need to implement the "Gyroscopic Damping" effect to stabilize the wheel during drifts and prevent oscillations ("tank slappers").
**Constraint:** Do NOT attempt to implement a DirectInput "Damper" effect. Instead, implement **Synthetic Damping** by calculating a counter-force based on steering velocity and adding it to the main Constant Force output.

**Implementation Requirements:**

1.  **Update `FFBEngine.h`**:
    *   **New Settings:**
        *   `float m_gyro_gain = 0.0f;` (Default 0.0).
        *   `float m_gyro_smoothing = 0.1f;` (To filter the noisy derivative).
    *   **New State Variables:**
        *   `double m_prev_steering_angle = 0.0;`
        *   `double m_steering_velocity_smoothed = 0.0;`
    *   **Logic in `calculate_force`:**
        1.  **Calculate Steering Angle:** Convert `data->mUnfilteredSteering` (-1.0 to 1.0) to Radians.
            *   Use `data->mPhysicalSteeringWheelRange` if available (> 0).
            *   Fallback: Assume 540 degrees (approx 9.42 rad) if range is 0.
            *   Formula: `Angle = Input * (Range / 2.0)`.
        2.  **Calculate Velocity:** `RawVel = (Angle - m_prev_steering_angle) / dt`.
        3.  **Smooth Velocity:** Apply an Exponential Moving Average (LPF) to `RawVel` using `m_gyro_smoothing` to remove noise spikes.
        4.  **Calculate Damping Force:**
            *   Formula: `Force = -1.0 * SmoothedVel * m_gyro_gain * (CarSpeed / 10.0)`.
            *   *Note:* The force opposes velocity (negative sign). It scales with Car Speed (higher speed = more gyroscopic resistance).
        5.  **Add to Total:** `total_force += Force`.
    *   **Snapshot:** Add `ffb_gyro_damping` to `FFBSnapshot` for visualization.

2.  **Update Configuration (`src/Config.h` & `src/Config.cpp`)**:
    *   Update `Preset` struct to include `float gyro_gain`.
    *   Add fluent setter: `Preset& SetGyro(float v)`.
    *   Update Save/Load logic.
    *   Update `LoadPresets` (Default to 0.0).

3.  **Update GUI (`src/GuiLayer.cpp`)**:
    *   **Tuning Window:** Add a slider "Gyroscopic Damping" in the "Effects" or "Advanced" section (Range 0.0 to 1.0).
    *   **Debug Window:** Add a trace for "Gyro Damping" in the "FFB Components" graph.

4.  **Update Documentation**:
    *   Update `docs/dev_docs/FFB_formulas.md` with the Gyro Damping formula.

5.  **Add Unit Test (`tests/test_ffb_engine.cpp`)**:
    *   Create `test_gyro_damping()`.
    *   Scenario: Car moving fast (50 m/s). Steering moves rapidly from 0.0 to 0.1 in one frame.
    *   Assert: The calculated Gyro Force is **negative** (opposing the movement) and non-zero.

**Deliverables:**
1.  Modified `FFBEngine.h`.
2.  Modified `src/Config.h` and `src/Config.cpp`.
3.  Modified `src/GuiLayer.cpp`.
4.  Updated `docs/dev_docs/FFB_formulas.md`.
5.  Modified `tests/test_ffb_engine.cpp`.
6.  **Verification**: Run tests and ensure `test_gyro_damping` passes.