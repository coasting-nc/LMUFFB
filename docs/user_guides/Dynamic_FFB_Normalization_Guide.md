# LMUFFB Dynamic FFB Normalization & Wheelbase Scaling Guide

## 1. The End of "Max Torque Ref"

In previous versions, the `Max Torque Ref` slider was used to define your FFB strength. However, it was mathematically ambiguous: it tried to simultaneously dictate your hardware's capabilities and your subjective preference. This often led to confusion and compromised tactile vibrations.

### The New Physical Target Model
We have completely removed the `Max Torque Ref` slider and replaced it with two distinct, easy-to-understand parameters:

1.  **Wheelbase Max Torque (Nm):** This is a hardware specification. It tells the game exactly how strong your physical wheelbase is (e.g., 5 Nm for an entry-level wheel, or 25 Nm for a high-end Direct Drive wheelbase).
2.  **Target Rim Torque (Nm):** This is your personal preference. It defines the peak force intensity you want to feel in your hands. 

### Conceptual Shift
The major conceptual change is decoupling the *capability* of your hardware from the *intensity* of the FFB. 

By defining the actual strength of your wheelbase separately, LMUFFB can now render all **Tactile Effects** (road texture, ABS, slip rumble) using **absolute physical torque limits**. This means a 2.0 Nm tactile ABS pulse requested by the physics engine will map consistently regardless of what your wheelbase capabilities are or what your `Target Rim Torque` is set to.

---

## 2. How to Use the New Sliders

### Setting Your Hardware Limit
*   **Step 1:** Look up the maximum torque output of your physical wheelbase (e.g., Fanatec CSL DD 8Nm, Simagic Alpha Mini 10Nm, Simucube 2 Pro 25Nm).
*   **Step 2:** Set the **Wheelbase Max Torque** slider exactly to this value. 
*   **Note:** You rarely, if ever, need to change this setting once you have configured it for your hardware.

### Tuning Your Preference
*   **Step 1:** Adjust the **Target Rim Torque** slider to change how heavy the steering feels.
*   **Step 2:** If you prefer a lighter wheel for endurance racing, turn this down (e.g., 8 Nm or 10 Nm). If you want the full physical onslaught of a high-downforce prototype, turn it up!
*   **Note:** Changing your `Target Rim Torque` *only* scales the structural steering forces/weight. It will not dilute or artificially amplify the fine road textures.

### How Presets Will Be Affected
When you update to this version, the application will automatically migrate your old `Max Torque Ref` preset values to the new system safely:
- If your old `Max Torque Ref` was unrealistically high (e.g., set to 100 Nm as a workaround on older versions), the system defaults your setup to a safe starting point (15 Nm Wheelbase, 10 Nm Target Rim).
- If your old setting was accurate to your wheelbase output, it undergoes a direct 1:1 migration.
- All default Presets bundled with the app (Simagic, Moza, T300, etc.) have been fully rewritten and updated to use realistic Nm values utilizing the new dual-slider system.

---

## 3. Session-Learned Dynamic Normalization

One of the biggest historic challenges in sim racing FFB is dealing with the massive disparity in forces between car classes. A heavy GT3 car creates vastly different telemetry forces than a lightweight prototype.

### How It Works
LMUFFB now features **Session-Learned Dynamic Normalization**. Behind the scenes, the engine continuously tracks the maximum steering torque generated by the car's physics and uses a "Peak Follower" to dynamically scale the steering weight to consistently map against your requested `Target Rim Torque`.

### The User Experience
*   **Leaving the Pits:** When you first leave the garage in a new session, the FFB might feel slightly different as the system hasn't yet learned the peak forces of the car in the current track conditions.
*   **Stabilization Time:** The dynamic normalizer utilizes a fast-attack, exponential decay algorithm. This means it learns the peak forces very quickly (usually within the first major cornering event) and then stabilizes. You will notice the FFB dial into its intended consistency within the first lap.
*   **Spike Rejection:** Don't worry about crashing or aggressively riding kerbs while the system calibrates! We've implemented "Contextual Spike Rejection," which ignores massive anomalous physics spikes (like hitting a wall or hyper-aggressive bottoming out) so they do not corrupt the normalizer's baseline.

---

## 4. Tactile Haptics & High-Speed Aerodynamics

To ensure you can always feel what the front tires are doing, the way tactile haptics are handled has been dramatically overhauled.

*   **Static Load Anchoring:** Historically, tactile vibrations could feel "dead" at low speeds, or violently aggressive at high speeds due to extreme aerodynamic downforce inflating the FFB calculations. We now anchor texture scaling to the vehicle's raw **Static Mechanical Load**.
*   **The 2-15 m/s Learning Phase:** The game learns the true, non-aero static weight of the car exclusively while driving at low speeds between 2 and 15 m/s. 
*   **Persistent Storage:** You don't have to perform a "warm-up roll" every time you drive. Once a specific car's static weight is learned, it is permanently saved in your configuration. On all future sessions with that car, the application will instantly load the saved static weight, providing identical, perfect tactile detail straight out of the pits!
*   **Soft-Knee Compression:** When you *do* reach top speeds in high-downforce cars, a sophisticated "Soft-Knee Compression" algorithm progressively tapers the tactile multipliers. This ensures road details remain prominent but prevents your wheel from violently shaking itself out of your hands under maximum aero load.
